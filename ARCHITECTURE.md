# TUMA TAXI - ARCHITECTURE DIAGRAM

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FRONTEND (Next.js 14)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Driver       â”‚  â”‚ Rider        â”‚  â”‚ Admin Dashboard      â”‚  â”‚
â”‚  â”‚ Dashboard    â”‚  â”‚ App          â”‚  â”‚                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                â”‚                      â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    NEXT.JS API ROUTES (App Router)     â”‚
         â”‚                                        â”‚
         â”‚  POST /api/rides/calculate-commission â”‚
         â”‚  POST /api/rides/create                â”‚
         â”‚  GET  /api/drivers/:id/stats           â”‚
         â”‚  POST /api/payments/process            â”‚
         â”‚  (More routes to come)                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  RULIAL LOGIC LAYER (Commission System) â”‚
        â”‚                                         â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚  calculateCommission()             â”‚ â”‚
        â”‚  â”‚  - Input: driverId, fare, metrics â”‚ â”‚
        â”‚  â”‚  - Output: CommissionOutput       â”‚ â”‚
        â”‚  â”‚  - 17% base (BRONZE)              â”‚ â”‚
        â”‚  â”‚  - 15% for SILVER                 â”‚ â”‚
        â”‚  â”‚  - 12% for GOLD                   â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                         â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚  Utilities:                        â”‚ â”‚
        â”‚  â”‚  - generateTxHash()                â”‚ â”‚
        â”‚  â”‚  - validateTxHash()                â”‚ â”‚
        â”‚  â”‚  - roundMZN()                      â”‚ â”‚
        â”‚  â”‚  - getWeekBoundary()               â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PRISMA ORM LAYER                      â”‚
        â”‚                                        â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ Models:                          â”‚  â”‚
        â”‚  â”‚ â€¢ User (DRIVER | RIDER | ADMIN)  â”‚  â”‚
        â”‚  â”‚ â€¢ DriverProfile (Tier, Location) â”‚  â”‚
        â”‚  â”‚ â€¢ Ride (Full lifecycle)          â”‚  â”‚
        â”‚  â”‚ â€¢ RulialLedger (Immutable)       â”‚  â”‚
        â”‚  â”‚ â€¢ Rating                         â”‚  â”‚
        â”‚  â”‚ â€¢ PromotionalBonus               â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  POSTGRESQL DATABASE (Supabase)        â”‚
        â”‚                                        â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ Tables (Auto-generated):         â”‚  â”‚
        â”‚  â”‚ â€¢ users                          â”‚  â”‚
        â”‚  â”‚ â€¢ driver_profiles                â”‚  â”‚
        â”‚  â”‚ â€¢ rides                          â”‚  â”‚
        â”‚  â”‚ â€¢ rulial_ledgers (â˜… Immutable)   â”‚  â”‚
        â”‚  â”‚ â€¢ ratings                        â”‚  â”‚
        â”‚  â”‚ â€¢ promotional_bonuses            â”‚  â”‚
        â”‚  â”‚                                  â”‚  â”‚
        â”‚  â”‚ â˜… RulialLedger has:             â”‚  â”‚
        â”‚  â”‚   - txHash (SHA256)              â”‚  â”‚
        â”‚  â”‚   - type (CREDIT/DEBIT)          â”‚  â”‚
        â”‚  â”‚   - reason (6 types)             â”‚  â”‚
        â”‚  â”‚   - amountMZN (Decimal 12,2)     â”‚  â”‚
        â”‚  â”‚   - verified status              â”‚  â”‚
        â”‚  â”‚                                  â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Ride Commission Calculation

```
RIDER REQUESTS RIDE
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create Ride Record       â”‚
â”‚ (REQUESTED status)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Match Driver             â”‚
â”‚ (MATCHED status)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Driver Arrives           â”‚
â”‚ (ARRIVED status)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ride Completes           â”‚
â”‚ (COMPLETED status)       â”‚
â”‚ Calculate Final Fare     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RULIAL LOGIC TRIGGER                   â”‚
â”‚ calculateCommission(                   â”‚
â”‚   driverId,                            â”‚
â”‚   finalFareMZN,                        â”‚
â”‚   {tier, weeklyRides, rating}          â”‚
â”‚ )                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                 â”‚                 â”‚                 â”‚
       â–¼                 â–¼                 â–¼                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ BRONZE  â”‚    â”‚   SILVER    â”‚  â”‚    GOLD      â”‚  â”‚ OUTPUT   â”‚
   â”‚ (17%)   â”‚    â”‚   (15%)     â”‚  â”‚   (12%)      â”‚  â”‚ {        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  rate: %, â”‚
       â”‚                 â”‚                 â”‚         â”‚  commissionâ”‚
       â”‚                 â”‚                 â”‚         â”‚  payout,  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  txHash   â”‚
                         â”‚                           â”‚ }        â”‚
                         â–¼                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Create TxHash    â”‚
                 â”‚ SHA256(driver +   â”‚
                 â”‚ fare + rate +     â”‚
                 â”‚ timestamp)        â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Create RulialLedger Entry  â”‚
            â”‚ - Type: DEBIT              â”‚
            â”‚ - Reason: COMMISSION       â”‚
            â”‚ - AmountMZN: commission    â”‚
            â”‚ - TxHash: [generated]      â”‚
            â”‚ - Verified: true           â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Create RulialLedger Entry  â”‚
            â”‚ - Type: CREDIT             â”‚
            â”‚ - Reason: RIDE_PAYOUT      â”‚
            â”‚ - AmountMZN: driver payout â”‚
            â”‚ - TxHash: [generated]      â”‚
            â”‚ - Verified: true           â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Update:              â”‚
              â”‚ â€¢ DriverProfile      â”‚
              â”‚   - Balance += payout â”‚
              â”‚   - TotalEarnings    â”‚
              â”‚   - WeeklyRides++    â”‚
              â”‚                      â”‚
              â”‚ â€¢ Ride               â”‚
              â”‚   - Commission Rate  â”‚
              â”‚   - Commission MZN   â”‚
              â”‚   - Driver Payout    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                 âœ… TRANSACTION COMPLETE
```

---

## Tier Elevation Logic

```
DRIVER METRICS INPUT
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚              â”‚                 â”‚
    â–¼             â–¼              â–¼                 â–¼
 weeklyRides   rating       totalRides        tier (current)
    â”‚             â”‚              â”‚                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ CHECK GOLD (100+)   â”‚
        â”‚ OR RATING (4.9+)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ If Yes â†’ RETURN GOLD    â”‚
        â”‚ (12% commission)        â”‚
        â”‚ + Instant Payout Access â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ CHECK SILVER (50+)  â”‚
        â”‚ OR RATING (4.8+)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ If Yes â†’ RETURN SILVER  â”‚
        â”‚ (15% commission)        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Else â†’ DEFAULT BRONZE   â”‚
        â”‚ (17% commission)        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ RETURN OUTPUT   â”‚
          â”‚ {               â”‚
          â”‚   tier,         â”‚
          â”‚   rate,         â”‚
          â”‚   reason        â”‚
          â”‚ }               â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema Relationships

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     User        â”‚
                    â”‚  (Driver/Rider) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚              â”‚
              â–¼              â–¼              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Driver   â”‚  â”‚   Ride  â”‚   â”‚ RulialLedger â”‚
        â”‚ Profile  â”‚  â”‚         â”‚   â”‚              â”‚
        â”‚          â”‚  â”‚ (1:many)â”‚   â”‚ (1:many)     â”‚
        â”‚ â€¢ Tier   â”‚  â”‚         â”‚   â”‚ â€¢ Type       â”‚
        â”‚ â€¢ Rating â”‚  â”‚ â€¢ Driverâ”‚   â”‚ â€¢ TxHash     â”‚
        â”‚ â€¢ Wallet â”‚  â”‚ â€¢ Rider â”‚   â”‚ â€¢ Amount     â”‚
        â”‚ â€¢ Verififâ”‚  â”‚ â€¢ Fare  â”‚   â”‚ â€¢ Reason     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â€¢ Comm  â”‚   â”‚ â€¢ Verified   â”‚
                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                      â”‚  Rating  â”‚
                      â”‚(M:1:many)â”‚
                      â”‚ â€¢ Score  â”‚
                      â”‚ â€¢ Commentâ”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Mozambique Localization Layer

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  MOZAMBIQUE CONFIG   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚TIMEZONEâ”‚        â”‚ LOCALE  â”‚        â”‚  CURRENCY    â”‚
    â”‚        â”‚        â”‚         â”‚        â”‚              â”‚
    â”‚Africa/ â”‚        â”‚pt-MZ    â”‚        â”‚MZN           â”‚
    â”‚Maputo  â”‚        â”‚         â”‚        â”‚              â”‚
    â”‚(CAT)   â”‚        â”‚Portuguese        â”‚Mozambican    â”‚
    â”‚        â”‚        â”‚-        â”‚        â”‚Metical       â”‚
    â”‚UTC+2   â”‚        â”‚Mozambique        â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚Format: 2dec  â”‚
        â”‚                    â”‚            â”‚              â”‚
        â”‚                    â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
    Week Reset          Formatting         Financial Calc
    (Every Sunday)      (pt-MZ)            Decimal(12,2)
    
    getWeekBoundary()   formatMZN()        calculateCommission()
    shouldReset()       LocaleOptions      roundMZN()
                                           isValidMZNAmount()
```

---

## Security & Immutability

```
                      TRANSACTION CREATED
                             â”‚
                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Collect Transaction     â”‚
              â”‚  Data:                   â”‚
              â”‚  â€¢ driverId              â”‚
              â”‚  â€¢ fareAmount (MZN)      â”‚
              â”‚  â€¢ commissionRate (%)    â”‚
              â”‚  â€¢ timestamp             â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Generate TxHash         â”‚
              â”‚                          â”‚
              â”‚  SHA256(                 â”‚
              â”‚    driverId +            â”‚
              â”‚    fare +                â”‚
              â”‚    rate +                â”‚
              â”‚    timestamp             â”‚
              â”‚  )                       â”‚
              â”‚                          â”‚
              â”‚  Result: 64-char hex     â”‚
              â”‚  e.g. a3f2b8c1...       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Store in RulialLedger   â”‚
              â”‚                          â”‚
              â”‚  âœ… TxHash (immutable)   â”‚
              â”‚  âœ… Amount (validated)   â”‚
              â”‚  âœ… Verified (true)      â”‚
              â”‚  âœ… CreatedAt (locked)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                        â”‚
         â–¼                                        â–¼
    ANY MODIFICATION?              REQUEST AUDIT?
         â”‚                                â”‚
         â–¼                                â–¼
    Hash Changes!              Query RulialLedger
    (Fraud Detected)           Verify TxHash
                               Compare original
```

---

## 3G Network Optimization

```
                      RESPONSE OPTIONS
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
    Full Data           Compressed Data      Binary Format
    (Desktop)           (Mobile 3G)          (Future)
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
    {                    {                    [compressed]
      id: uuid,           id: uuid,            # Field reduction
      status: string,      s: 0,                # Type conversion
      fare: decimal,       f: 500.0,            # Shorter keys
      ...                  d: driver_id,        # Minimal data
    }                      ...
                         }
        â”‚                    â”‚
        â–¼                    â–¼
    ~5KB per ride        ~800B per ride
                         (85% smaller)
```

---

## Development Roadmap

```
PHASE 1: SETUP âœ…
   â””â”€ Project structure
   â””â”€ Prisma schema
   â””â”€ Rulial logic
   â””â”€ Configuration

        â”‚
        â–¼

PHASE 2: DATABASE & AUTH
   â””â”€ Supabase setup
   â””â”€ NextAuth.js integration
   â””â”€ Phone verification

        â”‚
        â–¼

PHASE 3: CORE FEATURES
   â””â”€ Driver dashboard
   â””â”€ Rider app
   â””â”€ Location tracking

        â”‚
        â–¼

PHASE 4: PAYMENTS
   â””â”€ MZN gateway
   â””â”€ Wallet system
   â””â”€ Payout management

        â”‚
        â–¼

PHASE 5: DEPLOYMENT
   â””â”€ Docker
   â””â”€ Ionos hosting
   â””â”€ CI/CD pipeline

        â”‚
        â–¼

PHASE 6: LAUNCH ğŸš€
   â””â”€ Beta testing
   â””â”€ Production deployment
   â””â”€ Monitoring
```

---

**Generated**: January 31, 2026  
**Status**: âœ… ARCHITECTURE COMPLETE
